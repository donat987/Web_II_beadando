<!DOCTYPE html>
<html>
<head>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<style>
canvas {
    border:1px solid #d3d3d3;
    background-color: #f2f2f2;
}
</style>
</head>
<body onload="startGame()">
<script>

var Kocsi;
var Hatter;


function startGame() {
    Kocsi = new component(300, 600, "kepek/piroskocsi.png", 1050, 1200, "image");
    Kocsi1 = new component(300, 600, "kepek/kekkocsi.png", 30000, 1200, "image");
    Kocsi2 = new component(300, 600, "kepek/sargakocsi.png", 30000, 1200, "image");
    Taxi = new component(300, 600, "kepek/taxi.png", 30000, 1200, "image");
    Nyuszi = new component(75, 40, "kepek/nyuszi.png", 30000, 1200, "image");
    Baleset = new component(500, 270, "kepek/baleset.png", 30000, 120 , "image");
    Kutya = new component(300, 100, "kepek/kutya.png", 30000, 0 , "image");
    Katyu = new component(97, 80, "kepek/katyu.png", 30000, 0 , "image");
    Busz = new component(320, 900, "kepek/busz.png", 30000, 0 , "image");
   Hatter = new component(2400, 15000, "kepek/ut.png", 0, 0, "background");
   AkadalyBal = new component(0, 2000, "kepek/akadalyszele.png", 350, 0, "image");
   AkadalyJobb = new component(0, 2000, "kepek/akadalyszele.png", 2050, 0, "image");
   AkadalyFent = new component(2400, 0, "kepek/akadalyteto.png", 0, 0, "image");
   AkadalyLent = new component(10000, 4, "kepek/akadalyteto.png", 0, 0, "image");
    myGameArea.start();
}

var myGameArea = {
    canvas : document.createElement("canvas"),
    start : function() {
        this.canvas.width = 2400;
        this.canvas.height = 1500;
        this.context = this.canvas.getContext("2d");
        document.body.insertBefore(this.canvas, document.body.childNodes[0]);
        this.frameNo = 0;
        this.interval = setInterval(updateGameArea, 20);
        window.addEventListener('keydown', function (e) {
            e.preventDefault();
            myGameArea.keys = (myGameArea.keys || []);
            myGameArea.keys[e.keyCode] = (e.type == "keydown");
        })
        window.addEventListener('keyup', function (e) {
            myGameArea.keys[e.keyCode] = (e.type == "keydown");
        })
        },
    clear : function() {
        this.context.clearRect(0, 0, this.canvas.width, this.canvas.height);
    },
    stop : function() {
        clearInterval(this.interval);
    }
}

function component(width, height, color, x, y, type) {
    this.type = type;
    if (type == "image" || type == "background") {
        this.image = new Image();
        this.image.src = color;
    }
    this.width = width;
    this.height = height;
    this.speedX = 0;
    this.speedY = 0;    
    this.x = x;
    this.y = y;    
    this.update = function() {
        ctx = myGameArea.context;
        if (type == "image" || type == "background") {
            ctx.drawImage(this.image, 
                this.x, 
                this.y,
                this.width, this.height);
        
         if (type == "background") {
            ctx.drawImage(this.image, 
                this.x , 
                this.y - this.height,
                this.width, this.height);
        }
        
        } else {
            ctx.fillStyle = color;
            ctx.fillRect(this.x, this.y, this.width, this.height);
        }
    }
    this.newPos = function() {
        this.y += this.speedX;
        this.x += this.speedY;
        if (this.type == "background") {
            if (this.y == +(this.height)) {
                this.y = 0;
            }
        }
    }
    this.crashWith = function(otherobj) {
    var myleft = this.x;
    var myright = this.x + (this.width);
    var mytop = this.y;
    var mybottom = this.y + (this.height);
    var otherleft = otherobj.x;
    var otherright = otherobj.x + (otherobj.width);
    var othertop = otherobj.y;
    var otherbottom = otherobj.y + (otherobj.height);
    var crash = true;
    if ((mybottom < othertop) ||
    (mytop > otherbottom) ||
    (myright < otherleft) ||
    (myleft > otherright)) {
      crash = false;
    }
    return crash;
  }    
}

function updateGameArea() {
    let hiba=0;
    if (Kocsi.crashWith(Baleset) || Kocsi.crashWith(Kutya) || Kocsi.crashWith(Kocsi1) || Kocsi.crashWith(Kocsi2) || Kocsi.crashWith(Nyuszi) || Kocsi.crashWith(Taxi) || Kocsi.crashWith(Busz)) {
        myGameArea.stop();
  } else {
    if(Kocsi.crashWith(Katyu)){
        if(Math.floor(Math.random() * 10) % 2 == 0){
            hiba++;
            Kocsi.speedX = -5;
        }else{
            hiba++;
            Kocsi.speedY = 5;
        }
    }
    myGameArea.clear();
    AkadalyBal.y = 0;
    AkadalyJobb.y = 0;
    AkadalyFent.y = -200;
    AkadalyLent.y = 2000;
    Kutya.y += 20;
    Kutya.x += 20;
    Nyuszi.y += 20;
    Nyuszi.x -= 25;
    Baleset.y += 20;
    Katyu.y += 20;
    Busz.y += 10;
    Kocsi1.y += 12;
    Kocsi2.y += 13;
    Taxi.y += 14;
    if(Baleset.y > 37633){
        Baleset.y = -1000;
        Baleset.x = Math.floor(Math.random() * 1200)+400;
    }
    if(Katyu.y > 1500){
        Katyu.y = -1000;
        Katyu.x = Math.floor(Math.random() * 1200)+400;
        
    }
    if(Kutya.y > 65713){
        Kutya.y = -500;
        Kutya.x = 0;
    }
    if(Nyuszi.y > 69313 ){
        Nyuszi.y = -300;
        Nyuszi.x = 2000;
    }
    if(Busz.y > 13669 ){
        Busz.y = -1000;
        Busz.x = Math.floor(Math.random() * 1200)+400;
    }
    if(Kocsi1.y > 3001){
        Kocsi1.y = -1600;
        Kocsi1.x = Math.floor(Math.random() * 1200)+400;
    }
    if(Kocsi2.y > 5281){
        Kocsi2.y = -1600;
        Kocsi2.x = Math.floor(Math.random() * 1200)+400;
    }
    if(Taxi.y > 9461){
        Taxi.y = -1000;
        Taxi.x = Math.floor(Math.random() * 1200)+400;
    }
    if(Kocsi.crashWith(AkadalyBal)){
        Kocsi.speedY = 20
    }
    Hatter.speedX = 20;
    Hatter.newPos();    
    Hatter.update();
    
    //-----------------------------------------------------------------------------------
    //--------------------             Irányítás            -----------------------------
    //-----------------------------------------------------------------------------------
    if (myGameArea.keys && myGameArea.keys[37]) {
        if(Kocsi.crashWith(AkadalyBal)){
            Kocsi.speedY = 0;
        }else{
            Kocsi.speedY = -20;
        }
    }
    else if (myGameArea.keys && myGameArea.keys[39]) {
        if(Kocsi.crashWith(AkadalyJobb)){
            Kocsi.speedY = 0;
        }else{
            Kocsi.speedY = 20;
        }
    }
    
    else if (myGameArea.keys && myGameArea.keys[38]) {
        if(Kocsi.crashWith(AkadalyFent)){
            Kocsi.speedX = 0;
        }else{
            Kocsi.speedX = -20;
        }
    }
    else if (myGameArea.keys && myGameArea.keys[40]) { 
        if(Kocsi.crashWith(AkadalyLent)){
            Kocsi.speedX = 0;
        }else{
            Kocsi.speedX = 20; 
        } 
    }




    else if (hiba == 0){

        Kocsi.speedY = 0;
        Kocsi.speedX = 0;
    }
    Baleset.update();
    Kutya.update();
    Katyu.update();
    Busz.update();
    Kocsi1.update();
    Kocsi2.update();
    Taxi.update();
    Nyuszi.update();
    AkadalyBal.update();
    AkadalyJobb.update();
    AkadalyFent.update();
    AkadalyLent.update();
    Kocsi.newPos();    
    Kocsi.update();
    
}
}


</script>

</body>
</html>